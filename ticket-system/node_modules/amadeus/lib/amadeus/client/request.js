"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _qs = _interopRequireDefault(require("qs"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

/**
 * A Request object containing all the compiled information about this request.
 *
 * @property {string} host the host used for this API call
 * @property {number} port the port for this API call. Standard set to 443.
 * @property {boolean} ssl wether this API call uses SSL
 * @property {string} scheme the scheme inferred from the SSL state
 * @property {string} verb the HTTP method, for example `GET` or `POST`
 * @property {string} path the full path of the API endpoint
 * @property {Object} params the parameters to pass in the query or body
 * @property {string} queryPath the path and query string used for the API call
 * @property {string} bearerToken the authentication token
 * @property {string} clientVersion the version of the Amadeus library
 * @property {string} languageVersion the version of Node used
 * @property {string} appId the custom ID of the application using this library
 * @property {string} appVersion the custom version of the application
 *  using this library
 * @property {Object} headers the request headers
 *
 * @param {Object} options
 */
var Request =
/*#__PURE__*/
function () {
  function Request(options) {
    _classCallCheck(this, Request);

    this.host = options.host;
    this.port = options.port;
    this.ssl = options.ssl;
    this.scheme = this.ssl ? 'https' : 'http';
    this.verb = options.verb;
    this.path = options.path;
    this.params = options.params;
    this.queryPath = this.fullQueryPath();
    this.bearerToken = options.bearerToken;
    this.clientVersion = options.clientVersion;
    this.languageVersion = options.languageVersion.replace('v', '');
    this.appId = options.appId;
    this.appVersion = options.appVersion;
    this.headers = {
      'User-Agent': this.userAgent(),
      'Accept': 'application/json, application/vnd.amadeus+json'
    };
    this.ListHTTPOverride = ['/v2/shopping/flight-offers', '/v1/shopping/seatmaps', '/v1/shopping/availability/flight-availabilities', '/v2/shopping/flight-offers/prediction', '/v1/shopping/flight-offers/pricing', '/v1/shopping/flight-offers/upselling'];
    this.addAuthorizationHeader();
    this.addContentTypeHeader();
    this.addHTTPOverrideHeader();
  } // PROTECTED

  /**
   * Compiles the options for the HTTP request.
   *
   * Used by Client.execute when executing this request against the server.
   *
   * @return {Object} an associative array of options to be passed into the
   *  Client.execute function
   * @protected
   */


  _createClass(Request, [{
    key: "options",
    value: function options() {
      var options = {
        'host': this.host,
        'port': this.port,
        'protocol': "".concat(this.scheme, ":"),
        'path': this.queryPath,
        'method': this.verb,
        'headers': this.headers
      };
      return options;
    }
    /**
     * Creats the body for the API cal, serializing the params if the verb is POST.
     *
     * @return {string} the serialized params
     * @protected
     */

  }, {
    key: "body",
    value: function body() {
      if (this.verb !== 'POST') {
        return '';
      } else {
        if (!this.bearerToken) {
          return _qs["default"].stringify(this.params);
        }

        return this.params;
      }
    } // PRIVATE

    /**
     * Build up the custom User Agent
     *
     * @return {string} a user agent in the format "library/version language/version app/version"
     * @private
     */

  }, {
    key: "userAgent",
    value: function userAgent() {
      var userAgent = "amadeus-node/".concat(this.clientVersion, " node/").concat(this.languageVersion);

      if (!this.appId) {
        return userAgent;
      }

      return "".concat(userAgent, " ").concat(this.appId, "/").concat(this.appVersion);
    }
    /**
     * Build the full query path, combining the path with the query params if the
     * verb is 'GET'. For example: '/foo/bar?baz=qux'
     *
     * @return {string} the path and params combined into one string.
     * @private
     */

  }, {
    key: "fullQueryPath",
    value: function fullQueryPath() {
      if (this.verb === 'POST') {
        return this.path;
      } else {
        return "".concat(this.path, "?").concat(_qs["default"].stringify(this.params));
      }
    }
    /**
     * Adds an Authorization header if the BearerToken is present
     *
     * @private
     */

  }, {
    key: "addAuthorizationHeader",
    value: function addAuthorizationHeader() {
      if (!this.bearerToken) {
        return;
      }

      this.headers['Authorization'] = "Bearer ".concat(this.bearerToken);
    }
    /**
     * Adds an Content-Type header if the HTTP method equals POST
     *
     * @private
     */

  }, {
    key: "addContentTypeHeader",
    value: function addContentTypeHeader() {
      if (this.verb === 'POST' && !this.bearerToken) {
        this.headers['Content-Type'] = 'application/x-www-form-urlencoded';
      } else {
        this.headers['Content-Type'] = 'application/vnd.amadeus+json';
      }

      return;
    }
    /**
    * Adds HTTPOverride method if it is required
    *
    *  @private
    */

  }, {
    key: "addHTTPOverrideHeader",
    value: function addHTTPOverrideHeader() {
      if (this.verb === 'POST' && this.ListHTTPOverride.includes(this.path)) {
        this.headers['X-HTTP-Method-Override'] = 'GET';
      }

      return;
    }
  }]);

  return Request;
}();

var _default = Request;
exports["default"] = _default;
module.exports = exports["default"];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hbWFkZXVzL2NsaWVudC9yZXF1ZXN0LmpzIl0sIm5hbWVzIjpbIlJlcXVlc3QiLCJvcHRpb25zIiwiaG9zdCIsInBvcnQiLCJzc2wiLCJzY2hlbWUiLCJ2ZXJiIiwicGF0aCIsInBhcmFtcyIsInF1ZXJ5UGF0aCIsImZ1bGxRdWVyeVBhdGgiLCJiZWFyZXJUb2tlbiIsImNsaWVudFZlcnNpb24iLCJsYW5ndWFnZVZlcnNpb24iLCJyZXBsYWNlIiwiYXBwSWQiLCJhcHBWZXJzaW9uIiwiaGVhZGVycyIsInVzZXJBZ2VudCIsIkxpc3RIVFRQT3ZlcnJpZGUiLCJhZGRBdXRob3JpemF0aW9uSGVhZGVyIiwiYWRkQ29udGVudFR5cGVIZWFkZXIiLCJhZGRIVFRQT3ZlcnJpZGVIZWFkZXIiLCJxcyIsInN0cmluZ2lmeSIsImluY2x1ZGVzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7QUFFQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBcUJNQSxPOzs7QUFDSixtQkFBWUMsT0FBWixFQUFxQjtBQUFBOztBQUNuQixTQUFLQyxJQUFMLEdBQXVCRCxPQUFPLENBQUNDLElBQS9CO0FBQ0EsU0FBS0MsSUFBTCxHQUF1QkYsT0FBTyxDQUFDRSxJQUEvQjtBQUNBLFNBQUtDLEdBQUwsR0FBdUJILE9BQU8sQ0FBQ0csR0FBL0I7QUFDQSxTQUFLQyxNQUFMLEdBQXVCLEtBQUtELEdBQUwsR0FBVyxPQUFYLEdBQXFCLE1BQTVDO0FBQ0EsU0FBS0UsSUFBTCxHQUF1QkwsT0FBTyxDQUFDSyxJQUEvQjtBQUNBLFNBQUtDLElBQUwsR0FBdUJOLE9BQU8sQ0FBQ00sSUFBL0I7QUFDQSxTQUFLQyxNQUFMLEdBQXVCUCxPQUFPLENBQUNPLE1BQS9CO0FBQ0EsU0FBS0MsU0FBTCxHQUF1QixLQUFLQyxhQUFMLEVBQXZCO0FBQ0EsU0FBS0MsV0FBTCxHQUF1QlYsT0FBTyxDQUFDVSxXQUEvQjtBQUNBLFNBQUtDLGFBQUwsR0FBdUJYLE9BQU8sQ0FBQ1csYUFBL0I7QUFDQSxTQUFLQyxlQUFMLEdBQXVCWixPQUFPLENBQUNZLGVBQVIsQ0FBd0JDLE9BQXhCLENBQWdDLEdBQWhDLEVBQXFDLEVBQXJDLENBQXZCO0FBQ0EsU0FBS0MsS0FBTCxHQUF1QmQsT0FBTyxDQUFDYyxLQUEvQjtBQUNBLFNBQUtDLFVBQUwsR0FBdUJmLE9BQU8sQ0FBQ2UsVUFBL0I7QUFDQSxTQUFLQyxPQUFMLEdBQXVCO0FBQ3JCLG9CQUFlLEtBQUtDLFNBQUwsRUFETTtBQUVyQixnQkFBVztBQUZVLEtBQXZCO0FBSUEsU0FBS0MsZ0JBQUwsR0FBdUIsQ0FDckIsNEJBRHFCLEVBRXJCLHVCQUZxQixFQUdyQixpREFIcUIsRUFJckIsdUNBSnFCLEVBS3JCLG9DQUxxQixFQU1yQixzQ0FOcUIsQ0FBdkI7QUFRQSxTQUFLQyxzQkFBTDtBQUNBLFNBQUtDLG9CQUFMO0FBQ0EsU0FBS0MscUJBQUw7QUFDRCxHLENBRUQ7O0FBRUE7Ozs7Ozs7Ozs7Ozs7OEJBU1U7QUFDUixVQUFJckIsT0FBTyxHQUFHO0FBQ1osZ0JBQVMsS0FBS0MsSUFERjtBQUVaLGdCQUFTLEtBQUtDLElBRkY7QUFHWiw4QkFBZ0IsS0FBS0UsTUFBckIsTUFIWTtBQUlaLGdCQUFTLEtBQUtJLFNBSkY7QUFLWixrQkFBVyxLQUFLSCxJQUxKO0FBTVosbUJBQVksS0FBS1c7QUFOTCxPQUFkO0FBUUEsYUFBT2hCLE9BQVA7QUFDRDtBQUVEOzs7Ozs7Ozs7MkJBTU87QUFDTCxVQUFJLEtBQUtLLElBQUwsS0FBYyxNQUFsQixFQUEwQjtBQUFFLGVBQU8sRUFBUDtBQUFZLE9BQXhDLE1BQ0s7QUFDSCxZQUFJLENBQUMsS0FBS0ssV0FBVixFQUF1QjtBQUNyQixpQkFBT1ksZUFBR0MsU0FBSCxDQUFhLEtBQUtoQixNQUFsQixDQUFQO0FBQ0Q7O0FBQ0QsZUFBTyxLQUFLQSxNQUFaO0FBQ0Q7QUFDRixLLENBRUQ7O0FBRUE7Ozs7Ozs7OztnQ0FNWTtBQUNWLFVBQUlVLFNBQVMsMEJBQW1CLEtBQUtOLGFBQXhCLG1CQUE4QyxLQUFLQyxlQUFuRCxDQUFiOztBQUNBLFVBQUksQ0FBQyxLQUFLRSxLQUFWLEVBQWlCO0FBQUUsZUFBT0csU0FBUDtBQUFtQjs7QUFDdEMsdUJBQVVBLFNBQVYsY0FBdUIsS0FBS0gsS0FBNUIsY0FBcUMsS0FBS0MsVUFBMUM7QUFDRDtBQUVEOzs7Ozs7Ozs7O29DQU9nQjtBQUNkLFVBQUksS0FBS1YsSUFBTCxLQUFjLE1BQWxCLEVBQTBCO0FBQUUsZUFBTyxLQUFLQyxJQUFaO0FBQW1CLE9BQS9DLE1BQ0s7QUFBRSx5QkFBVSxLQUFLQSxJQUFmLGNBQXVCZ0IsZUFBR0MsU0FBSCxDQUFhLEtBQUtoQixNQUFsQixDQUF2QjtBQUFxRDtBQUM3RDtBQUVEOzs7Ozs7Ozs2Q0FLeUI7QUFDdkIsVUFBSSxDQUFDLEtBQUtHLFdBQVYsRUFBdUI7QUFBRTtBQUFTOztBQUNsQyxXQUFLTSxPQUFMLENBQWEsZUFBYixxQkFBMEMsS0FBS04sV0FBL0M7QUFDRDtBQUVEOzs7Ozs7OzsyQ0FLdUI7QUFDckIsVUFBSSxLQUFLTCxJQUFMLEtBQWMsTUFBZCxJQUF3QixDQUFDLEtBQUtLLFdBQWxDLEVBQStDO0FBQzdDLGFBQUtNLE9BQUwsQ0FBYSxjQUFiLElBQStCLG1DQUEvQjtBQUNELE9BRkQsTUFFTztBQUNMLGFBQUtBLE9BQUwsQ0FBYSxjQUFiLElBQStCLDhCQUEvQjtBQUNEOztBQUNEO0FBQ0Q7QUFFRDs7Ozs7Ozs7NENBS3dCO0FBQ3RCLFVBQUksS0FBS1gsSUFBTCxLQUFjLE1BQWQsSUFBd0IsS0FBS2EsZ0JBQUwsQ0FBc0JNLFFBQXRCLENBQStCLEtBQUtsQixJQUFwQyxDQUE1QixFQUF1RTtBQUNyRSxhQUFLVSxPQUFMLENBQWEsd0JBQWIsSUFBeUMsS0FBekM7QUFDRDs7QUFDRDtBQUNEOzs7Ozs7ZUFHWWpCLE8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcXMgZnJvbSAncXMnO1xuXG4vKipcbiAqIEEgUmVxdWVzdCBvYmplY3QgY29udGFpbmluZyBhbGwgdGhlIGNvbXBpbGVkIGluZm9ybWF0aW9uIGFib3V0IHRoaXMgcmVxdWVzdC5cbiAqXG4gKiBAcHJvcGVydHkge3N0cmluZ30gaG9zdCB0aGUgaG9zdCB1c2VkIGZvciB0aGlzIEFQSSBjYWxsXG4gKiBAcHJvcGVydHkge251bWJlcn0gcG9ydCB0aGUgcG9ydCBmb3IgdGhpcyBBUEkgY2FsbC4gU3RhbmRhcmQgc2V0IHRvIDQ0My5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gc3NsIHdldGhlciB0aGlzIEFQSSBjYWxsIHVzZXMgU1NMXG4gKiBAcHJvcGVydHkge3N0cmluZ30gc2NoZW1lIHRoZSBzY2hlbWUgaW5mZXJyZWQgZnJvbSB0aGUgU1NMIHN0YXRlXG4gKiBAcHJvcGVydHkge3N0cmluZ30gdmVyYiB0aGUgSFRUUCBtZXRob2QsIGZvciBleGFtcGxlIGBHRVRgIG9yIGBQT1NUYFxuICogQHByb3BlcnR5IHtzdHJpbmd9IHBhdGggdGhlIGZ1bGwgcGF0aCBvZiB0aGUgQVBJIGVuZHBvaW50XG4gKiBAcHJvcGVydHkge09iamVjdH0gcGFyYW1zIHRoZSBwYXJhbWV0ZXJzIHRvIHBhc3MgaW4gdGhlIHF1ZXJ5IG9yIGJvZHlcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBxdWVyeVBhdGggdGhlIHBhdGggYW5kIHF1ZXJ5IHN0cmluZyB1c2VkIGZvciB0aGUgQVBJIGNhbGxcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBiZWFyZXJUb2tlbiB0aGUgYXV0aGVudGljYXRpb24gdG9rZW5cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBjbGllbnRWZXJzaW9uIHRoZSB2ZXJzaW9uIG9mIHRoZSBBbWFkZXVzIGxpYnJhcnlcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBsYW5ndWFnZVZlcnNpb24gdGhlIHZlcnNpb24gb2YgTm9kZSB1c2VkXG4gKiBAcHJvcGVydHkge3N0cmluZ30gYXBwSWQgdGhlIGN1c3RvbSBJRCBvZiB0aGUgYXBwbGljYXRpb24gdXNpbmcgdGhpcyBsaWJyYXJ5XG4gKiBAcHJvcGVydHkge3N0cmluZ30gYXBwVmVyc2lvbiB0aGUgY3VzdG9tIHZlcnNpb24gb2YgdGhlIGFwcGxpY2F0aW9uXG4gKiAgdXNpbmcgdGhpcyBsaWJyYXJ5XG4gKiBAcHJvcGVydHkge09iamVjdH0gaGVhZGVycyB0aGUgcmVxdWVzdCBoZWFkZXJzXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAqL1xuY2xhc3MgUmVxdWVzdCB7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICB0aGlzLmhvc3QgICAgICAgICAgICA9IG9wdGlvbnMuaG9zdDtcbiAgICB0aGlzLnBvcnQgICAgICAgICAgICA9IG9wdGlvbnMucG9ydDtcbiAgICB0aGlzLnNzbCAgICAgICAgICAgICA9IG9wdGlvbnMuc3NsO1xuICAgIHRoaXMuc2NoZW1lICAgICAgICAgID0gdGhpcy5zc2wgPyAnaHR0cHMnIDogJ2h0dHAnO1xuICAgIHRoaXMudmVyYiAgICAgICAgICAgID0gb3B0aW9ucy52ZXJiO1xuICAgIHRoaXMucGF0aCAgICAgICAgICAgID0gb3B0aW9ucy5wYXRoO1xuICAgIHRoaXMucGFyYW1zICAgICAgICAgID0gb3B0aW9ucy5wYXJhbXM7XG4gICAgdGhpcy5xdWVyeVBhdGggICAgICAgPSB0aGlzLmZ1bGxRdWVyeVBhdGgoKTtcbiAgICB0aGlzLmJlYXJlclRva2VuICAgICA9IG9wdGlvbnMuYmVhcmVyVG9rZW47XG4gICAgdGhpcy5jbGllbnRWZXJzaW9uICAgPSBvcHRpb25zLmNsaWVudFZlcnNpb247XG4gICAgdGhpcy5sYW5ndWFnZVZlcnNpb24gPSBvcHRpb25zLmxhbmd1YWdlVmVyc2lvbi5yZXBsYWNlKCd2JywgJycpO1xuICAgIHRoaXMuYXBwSWQgICAgICAgICAgID0gb3B0aW9ucy5hcHBJZDtcbiAgICB0aGlzLmFwcFZlcnNpb24gICAgICA9IG9wdGlvbnMuYXBwVmVyc2lvbjtcbiAgICB0aGlzLmhlYWRlcnMgICAgICAgICA9IHtcbiAgICAgICdVc2VyLUFnZW50JyA6IHRoaXMudXNlckFnZW50KCksXG4gICAgICAnQWNjZXB0JyA6ICdhcHBsaWNhdGlvbi9qc29uLCBhcHBsaWNhdGlvbi92bmQuYW1hZGV1cytqc29uJ1xuICAgIH07XG4gICAgdGhpcy5MaXN0SFRUUE92ZXJyaWRlPSBbXG4gICAgICAnL3YyL3Nob3BwaW5nL2ZsaWdodC1vZmZlcnMnLFxuICAgICAgJy92MS9zaG9wcGluZy9zZWF0bWFwcycsXG4gICAgICAnL3YxL3Nob3BwaW5nL2F2YWlsYWJpbGl0eS9mbGlnaHQtYXZhaWxhYmlsaXRpZXMnLFxuICAgICAgJy92Mi9zaG9wcGluZy9mbGlnaHQtb2ZmZXJzL3ByZWRpY3Rpb24nLFxuICAgICAgJy92MS9zaG9wcGluZy9mbGlnaHQtb2ZmZXJzL3ByaWNpbmcnLFxuICAgICAgJy92MS9zaG9wcGluZy9mbGlnaHQtb2ZmZXJzL3Vwc2VsbGluZydcbiAgICBdO1xuICAgIHRoaXMuYWRkQXV0aG9yaXphdGlvbkhlYWRlcigpO1xuICAgIHRoaXMuYWRkQ29udGVudFR5cGVIZWFkZXIoKTtcbiAgICB0aGlzLmFkZEhUVFBPdmVycmlkZUhlYWRlcigpO1xuICB9XG5cbiAgLy8gUFJPVEVDVEVEXG5cbiAgLyoqXG4gICAqIENvbXBpbGVzIHRoZSBvcHRpb25zIGZvciB0aGUgSFRUUCByZXF1ZXN0LlxuICAgKlxuICAgKiBVc2VkIGJ5IENsaWVudC5leGVjdXRlIHdoZW4gZXhlY3V0aW5nIHRoaXMgcmVxdWVzdCBhZ2FpbnN0IHRoZSBzZXJ2ZXIuXG4gICAqXG4gICAqIEByZXR1cm4ge09iamVjdH0gYW4gYXNzb2NpYXRpdmUgYXJyYXkgb2Ygb3B0aW9ucyB0byBiZSBwYXNzZWQgaW50byB0aGVcbiAgICogIENsaWVudC5leGVjdXRlIGZ1bmN0aW9uXG4gICAqIEBwcm90ZWN0ZWRcbiAgICovXG4gIG9wdGlvbnMoKSB7XG4gICAgbGV0IG9wdGlvbnMgPSB7XG4gICAgICAnaG9zdCcgOiB0aGlzLmhvc3QsXG4gICAgICAncG9ydCcgOiB0aGlzLnBvcnQsXG4gICAgICAncHJvdG9jb2wnIDogYCR7dGhpcy5zY2hlbWV9OmAsXG4gICAgICAncGF0aCcgOiB0aGlzLnF1ZXJ5UGF0aCxcbiAgICAgICdtZXRob2QnIDogdGhpcy52ZXJiLFxuICAgICAgJ2hlYWRlcnMnIDogdGhpcy5oZWFkZXJzXG4gICAgfTtcbiAgICByZXR1cm4gb3B0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdHMgdGhlIGJvZHkgZm9yIHRoZSBBUEkgY2FsLCBzZXJpYWxpemluZyB0aGUgcGFyYW1zIGlmIHRoZSB2ZXJiIGlzIFBPU1QuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gdGhlIHNlcmlhbGl6ZWQgcGFyYW1zXG4gICAqIEBwcm90ZWN0ZWRcbiAgICovXG4gIGJvZHkoKSB7XG4gICAgaWYgKHRoaXMudmVyYiAhPT0gJ1BPU1QnKSB7IHJldHVybiAnJzsgfVxuICAgIGVsc2Uge1xuICAgICAgaWYgKCF0aGlzLmJlYXJlclRva2VuKSB7XG4gICAgICAgIHJldHVybiBxcy5zdHJpbmdpZnkodGhpcy5wYXJhbXMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMucGFyYW1zO1xuICAgIH1cbiAgfVxuXG4gIC8vIFBSSVZBVEVcblxuICAvKipcbiAgICogQnVpbGQgdXAgdGhlIGN1c3RvbSBVc2VyIEFnZW50XG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gYSB1c2VyIGFnZW50IGluIHRoZSBmb3JtYXQgXCJsaWJyYXJ5L3ZlcnNpb24gbGFuZ3VhZ2UvdmVyc2lvbiBhcHAvdmVyc2lvblwiXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICB1c2VyQWdlbnQoKSB7XG4gICAgbGV0IHVzZXJBZ2VudCA9IGBhbWFkZXVzLW5vZGUvJHt0aGlzLmNsaWVudFZlcnNpb259IG5vZGUvJHt0aGlzLmxhbmd1YWdlVmVyc2lvbn1gO1xuICAgIGlmICghdGhpcy5hcHBJZCkgeyByZXR1cm4gdXNlckFnZW50OyB9XG4gICAgcmV0dXJuIGAke3VzZXJBZ2VudH0gJHt0aGlzLmFwcElkfS8ke3RoaXMuYXBwVmVyc2lvbn1gO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1aWxkIHRoZSBmdWxsIHF1ZXJ5IHBhdGgsIGNvbWJpbmluZyB0aGUgcGF0aCB3aXRoIHRoZSBxdWVyeSBwYXJhbXMgaWYgdGhlXG4gICAqIHZlcmIgaXMgJ0dFVCcuIEZvciBleGFtcGxlOiAnL2Zvby9iYXI/YmF6PXF1eCdcbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSB0aGUgcGF0aCBhbmQgcGFyYW1zIGNvbWJpbmVkIGludG8gb25lIHN0cmluZy5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIGZ1bGxRdWVyeVBhdGgoKSB7XG4gICAgaWYgKHRoaXMudmVyYiA9PT0gJ1BPU1QnKSB7IHJldHVybiB0aGlzLnBhdGg7IH1cbiAgICBlbHNlIHsgcmV0dXJuIGAke3RoaXMucGF0aH0/JHtxcy5zdHJpbmdpZnkodGhpcy5wYXJhbXMpfWA7IH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGFuIEF1dGhvcml6YXRpb24gaGVhZGVyIGlmIHRoZSBCZWFyZXJUb2tlbiBpcyBwcmVzZW50XG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBhZGRBdXRob3JpemF0aW9uSGVhZGVyKCkge1xuICAgIGlmICghdGhpcy5iZWFyZXJUb2tlbikgeyByZXR1cm47IH1cbiAgICB0aGlzLmhlYWRlcnNbJ0F1dGhvcml6YXRpb24nXSA9IGBCZWFyZXIgJHt0aGlzLmJlYXJlclRva2VufWA7XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBhbiBDb250ZW50LVR5cGUgaGVhZGVyIGlmIHRoZSBIVFRQIG1ldGhvZCBlcXVhbHMgUE9TVFxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgYWRkQ29udGVudFR5cGVIZWFkZXIoKSB7XG4gICAgaWYgKHRoaXMudmVyYiA9PT0gJ1BPU1QnICYmICF0aGlzLmJlYXJlclRva2VuKSB7XG4gICAgICB0aGlzLmhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24vdm5kLmFtYWRldXMranNvbic7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuXG4gIC8qKlxuICAqIEFkZHMgSFRUUE92ZXJyaWRlIG1ldGhvZCBpZiBpdCBpcyByZXF1aXJlZFxuICAqXG4gICogIEBwcml2YXRlXG4gICovXG4gIGFkZEhUVFBPdmVycmlkZUhlYWRlcigpIHtcbiAgICBpZiAodGhpcy52ZXJiID09PSAnUE9TVCcgJiYgdGhpcy5MaXN0SFRUUE92ZXJyaWRlLmluY2x1ZGVzKHRoaXMucGF0aCkpIHtcbiAgICAgIHRoaXMuaGVhZGVyc1snWC1IVFRQLU1ldGhvZC1PdmVycmlkZSddID0gJ0dFVCc7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSZXF1ZXN0O1xuIl19